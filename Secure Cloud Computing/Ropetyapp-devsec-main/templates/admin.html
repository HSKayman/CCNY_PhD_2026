<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="RoboPety - Admin Dashboard" />
    <meta name="robots" content="noindex, nofollow" />
    <title>RoboPety - Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='icon-fallback.css') }}" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
  </head>
  <body>
    <div class="admin-dashboard">
      <header class="admin-header">
        <div class="header-left">
          <h1><i class="bx bx-shield-quarter"></i> Admin Dashboard</h1>
          <p class="admin-name">Welcome, {{ username|e }}</p>
        </div>
        <div class="header-right">
          <a href="{{ url_for('logout') }}" class="logout-btn">
            <i class="bx bx-log-out"></i> Logout
          </a>
        </div>
      </header>

      <div class="admin-content">
        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon users-icon">
              <i class="bx bx-user"></i>
            </div>
            <div class="stat-info">
              <h3 id="total-users">0</h3>
              <p>Total Users</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon bookings-icon">
              <i class="bx bx-bookmark"></i>
            </div>
            <div class="stat-info">
              <h3 id="total-bookings">0</h3>
              <p>Active Bookings</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon robots-icon">
              <i class="bx bx-robot"></i>
            </div>
            <div class="stat-info">
              <h3 id="total-robots">0</h3>
              <p>Available Robots</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon alerts-icon">
              <i class="bx bx-bell"></i>
            </div>
            <div class="stat-info">
              <h3 id="pending-alerts">0</h3>
              <p>Pending Alerts</p>
            </div>
          </div>
        </div>

        <!-- Main Content Tabs -->
        <div class="tabs-container">
          <div class="tabs">
            <button class="tab-btn active" data-tab="bookings">
              <i class="bx bx-list-ul"></i> Bookings
            </button>
            <button class="tab-btn" data-tab="users">
              <i class="bx bx-user-circle"></i> Users
            </button>
            <button class="tab-btn" data-tab="alerts">
              <i class="bx bx-bell"></i> Send Alerts
            </button>
            <button class="tab-btn" data-tab="monitoring">
              <i class="bx bx-line-chart"></i> Monitoring
            </button>
            <button class="tab-btn" data-tab="chat">
              <i class="bx bx-message-dots"></i> Chat Support
            </button>
            <button class="tab-btn" data-tab="announcements">
              <i class="bx bx-bullhorn"></i> Announcements
            </button>
            <button class="tab-btn" data-tab="robots">
              <i class="bx bx-cog"></i> Robot Management
            </button>
            <button class="tab-btn" data-tab="analytics">
              <i class="bx bx-line-chart"></i> Analytics
            </button>
            <button class="tab-btn" data-tab="activity">
              <i class="bx bx-history"></i> Activity Log
            </button>
            <button class="tab-btn" data-tab="2fa-management">
              <i class="bx bx-shield-quarter"></i> 2FA Management
            </button>
            <button class="tab-btn" data-tab="security-threats">
              <i class="bx bx-error-circle"></i> Security Threats
            </button>
            <button class="tab-btn" data-tab="admin-2fa">
              <i class="bx bx-shield"></i> My 2FA
            </button>
          </div>

          <!-- Bookings Tab -->
          <div class="tab-content active" id="bookings-tab">
            <div class="content-header">
              <h2><i class="bx bx-bookmark"></i> Current Bookings</h2>
              <button class="refresh-btn" onclick="loadBookings()">
                <i class="bx bx-refresh"></i> Refresh
              </button>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>User</th>
                    <th>Email</th>
                    <th>Robot</th>
                    <th>Booked At</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="bookings-table-body">
                  <tr>
                    <td colspan="5" class="loading">Loading bookings...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Users Tab -->
          <div class="tab-content" id="users-tab">
            <div class="content-header">
              <h2><i class="bx bx-user-circle"></i> All Users</h2>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" id="user-search-input" placeholder="Search users..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; width: 200px;" />
                <button class="refresh-btn" onclick="searchUsers()">
                  <i class="bx bx-search"></i> Search
                </button>
                <button class="refresh-btn" onclick="loadUsers()">
                  <i class="bx bx-refresh"></i> Refresh
                </button>
                <button class="refresh-btn" onclick="showCreateAdminModal()" style="background: var(--success);">
                  <i class="bx bx-user-plus"></i> Add Admin
                </button>
                <button class="refresh-btn" onclick="bulkDeleteUsers()" style="background: var(--error);" id="bulk-delete-btn" disabled>
                  <i class="bx bx-trash"></i> Delete Selected
                </button>
              </div>
            </div>
            <!-- Create Admin Form Section -->
            <div class="create-admin-section" id="create-admin-section" style="display: none; margin-bottom: 20px; padding: 20px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
              <h3 style="margin-bottom: 15px; color: var(--text-primary);">
                <i class="bx bx-user-plus"></i> Create New Admin User
              </h3>
              <form id="create-admin-form" onsubmit="createAdminUser(event); return false;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                  <div class="form-group">
                    <label for="admin-username">Username:</label>
                    <input type="text" id="admin-username" name="username" required maxlength="30" placeholder="Enter username" />
                  </div>
                  <div class="form-group">
                    <label for="admin-email">Email:</label>
                    <input type="email" id="admin-email" name="email" required maxlength="255" placeholder="Enter email" />
                  </div>
                  <div class="form-group">
                    <label for="admin-password">Password:</label>
                    <input type="password" id="admin-password" name="password" required minlength="8" placeholder="Enter password" />
                  </div>
                </div>
                <div style="display: flex; gap: 10px;">
                  <button type="submit" class="btn-primary">
                    <i class="bx bx-user-plus"></i> Create Admin
                  </button>
                  <button type="button" class="btn-secondary" onclick="hideCreateAdminModal()">
                    Cancel
                  </button>
                </div>
              </form>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th><input type="checkbox" id="select-all-users" onchange="toggleSelectAllUsers(this)" /></th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Bookings</th>
                    <th>Last Login</th>
                    <th>Joined</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="users-table-body">
                  <tr>
                    <td colspan="6" class="loading">Loading users...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Alerts Tab -->
          <div class="tab-content" id="alerts-tab">
            <div class="content-header">
              <h2><i class="bx bx-bell"></i> Send Alert to User</h2>
              <button class="refresh-btn" onclick="loadAllAlerts()">
                <i class="bx bx-refresh"></i> Refresh
              </button>
            </div>
            
            <!-- Send Alert Form -->
            <div class="alert-form-container" style="margin-bottom: 30px;">
              <form id="send-alert-form" class="alert-form">
                <div class="form-group">
                  <label for="alert-user-select">Select User:</label>
                  <select id="alert-user-select" name="user_id" required>
                    <option value="">-- Select a user --</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="alert-message">Message:</label>
                  <textarea 
                    id="alert-message" 
                    name="message" 
                    rows="4" 
                    placeholder="Thanks for having the robopet, do give a feedback!"
                    required
                  >Thanks for having the robopet, do give a feedback!</textarea>
                </div>
                <button type="submit" class="send-alert-btn">
                  <i class="bx bx-send"></i> Send Alert
                </button>
              </form>
            </div>
            
            <!-- All Alerts List -->
            <div style="margin-top: 30px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;"><i class="bx bx-list-ul"></i> All Alerts</h3>
                <div style="display: flex; gap: 10px;">
                  <button class="refresh-btn" onclick="deleteOldAlerts()" style="background: var(--error);">
                    <i class="bx bx-trash"></i> Delete Old Alerts (30+ days)
                  </button>
                </div>
              </div>
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>User</th>
                      <th>Email</th>
                      <th>Message</th>
                      <th>Status</th>
                      <th>Created At</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="all-alerts-table-body">
                    <tr>
                      <td colspan="7" class="loading">Loading alerts...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Monitoring Tab -->
          <div class="tab-content" id="monitoring-tab">
            <div class="content-header">
              <h2><i class="bx bx-line-chart"></i> System Monitoring</h2>
              <button class="refresh-btn" onclick="loadMonitoring()">
                <i class="bx bx-refresh"></i> Refresh
              </button>
            </div>
            <div class="monitoring-grid">
              <div class="monitor-card">
                <h3><i class="bx bx-trending-up"></i> Booking Activity</h3>
                <div class="monitor-content">
                  <p class="monitor-stat" id="bookings-today">0</p>
                  <p class="monitor-label">Bookings Today</p>
                </div>
              </div>
              <div class="monitor-card">
                <h3><i class="bx bx-user-plus"></i> User Growth</h3>
                <div class="monitor-content">
                  <p class="monitor-stat" id="users-today">0</p>
                  <p class="monitor-label">New Users Today</p>
                </div>
              </div>
              <div class="monitor-card">
                <h3><i class="bx bx-time"></i> Average Booking Duration</h3>
                <div class="monitor-content">
                  <p class="monitor-stat" id="avg-duration">0h</p>
                  <p class="monitor-label">Hours</p>
                </div>
              </div>
              <div class="monitor-card">
                <h3><i class="bx bx-star"></i> Most Popular Robot</h3>
                <div class="monitor-content">
                  <p class="monitor-stat" id="popular-robot">-</p>
                  <p class="monitor-label">Robot Name</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Announcements Tab -->
          <div class="tab-content" id="announcements-tab">
            <div class="content-header">
              <h2><i class="bx bx-bullhorn"></i> Manage Announcements</h2>
              <button class="refresh-btn" onclick="loadAnnouncementsAdmin()">
                <i class="bx bx-refresh"></i> Refresh
              </button>
            </div>
            
            <div class="announcements-admin-section">
              <div class="announcements-form-section">
                <h3>Create New Announcement</h3>
                <form id="announcement-form" onsubmit="createAnnouncement(event)">
                  <div class="form-group">
                    <label for="announcement-title">Title</label>
                    <input type="text" id="announcement-title" name="title" maxlength="255" required placeholder="e.g., New RoboPet Arrival" />
                  </div>
                  <div class="form-group">
                    <label for="announcement-message">Message</label>
                    <textarea id="announcement-message" name="message" maxlength="1000" required rows="4" placeholder="e.g., New RoboPet 'Sparky' is now available! Or: RoboPet 'Buddy' will be unavailable on Dec 15th."></textarea>
                  </div>
                  <button type="submit" class="btn-primary">
                    <i class="bx bx-plus"></i> Create Announcement
                  </button>
                </form>
              </div>
              
              <div class="announcements-list-section">
                <h3>Active Announcements</h3>
                <div id="announcements-list-admin" class="announcements-list-container">
                  <div class="loading">Loading announcements...</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Chat Support Tab -->
          <div class="tab-content" id="chat-tab">
            <div class="content-header">
              <h2><i class="bx bx-message-dots"></i> Chat Support</h2>
              <button class="refresh-btn" onclick="loadChatConversations()">
                <i class="bx bx-refresh"></i> Refresh
              </button>
            </div>
            <div class="chat-admin-container">
              <div class="chat-conversations-list">
                <h3>Conversations</h3>
                <div id="chat-conversations-list" class="conversations-list">
                  <div class="loading">Loading conversations...</div>
                </div>
              </div>
              <div class="chat-messages-panel">
                <div id="chat-messages-panel-empty" class="chat-empty-panel">
                  <i class="bx bx-message-dots" style="font-size: 48px; color: #636E72; margin-bottom: 20px;"></i>
                  <p>Select a conversation to view messages</p>
                </div>
                <div id="chat-messages-panel" class="chat-messages-panel-content" style="display: none;">
                  <div class="chat-messages-header">
                    <h3 id="chat-user-name">User Name</h3>
                    <span id="chat-user-email" class="chat-user-email"></span>
                  </div>
                  <div class="chat-messages-container" id="admin-chat-messages">
                    <!-- Messages will be loaded here -->
                  </div>
                  <div class="chat-input-container-admin">
                    <input type="text" class="chat-input-admin" id="admin-chat-input" placeholder="Type your reply..." maxlength="1000" autocomplete="off" />
                    <button class="chat-send-btn-admin" id="admin-chat-send-btn">
                      <i class="bx bx-send"></i> Send
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Robot Management Tab -->
          <div class="tab-content" id="robots-tab">
            <div class="content-header">
              <h2><i class="bx bx-cog"></i> Robot Management</h2>
              <button class="refresh-btn" onclick="loadRobots()">
                <i class="bx bx-refresh"></i> Refresh
              </button>
            </div>
            <div class="robots-management-section">
              <div class="robots-form-section">
                <h3>Add New Robot</h3>
                <form id="robot-form" onsubmit="createRobot(event)">
                  <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="robot-name" name="name" maxlength="255" required />
                  </div>
                  <div class="form-group">
                    <label>Photo URL</label>
                    <input type="text" id="robot-photo-url" name="photo_url" maxlength="255" required />
                  </div>
                  <div class="form-group">
                    <label>Description</label>
                    <textarea id="robot-description" name="description" rows="3" maxlength="1000"></textarea>
                  </div>
                  <div class="form-group">
                    <label>Category</label>
                    <input type="text" id="robot-category" name="category" maxlength="100" />
                  </div>
                  <div class="form-group">
                    <label>Status</label>
                    <select id="robot-status" name="status">
                      <option value="available">Available</option>
                      <option value="maintenance">Maintenance</option>
                      <option value="unavailable">Unavailable</option>
                    </select>
                  </div>
                  <button type="submit" class="btn-primary">
                    <i class="bx bx-plus"></i> Add Robot
                  </button>
                </form>
              </div>
              <div class="robots-list-section">
                <h3>All Robots</h3>
                <div class="table-container">
                  <table class="data-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Category</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="robots-table-body">
                      <tr><td colspan="5" class="loading">Loading robots...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Analytics Tab -->
          <div class="tab-content" id="analytics-tab">
            <div class="content-header">
              <h2><i class="bx bx-line-chart"></i> Analytics Dashboard</h2>
              <div style="display: flex; gap: 10px;">
                <input type="date" id="analytics-start-date" />
                <input type="date" id="analytics-end-date" />
                <button class="refresh-btn" onclick="loadAnalytics()">
                  <i class="bx bx-refresh"></i> Refresh
                </button>
                <button class="refresh-btn" onclick="exportBookings()" style="background: var(--success);">
                  <i class="bx bx-download"></i> Export CSV
                </button>
              </div>
            </div>
            <div class="analytics-grid">
              <div class="analytics-card">
                <h3>Total Bookings</h3>
                <p class="analytics-stat" id="analytics-total-bookings">0</p>
              </div>
              <div class="analytics-card">
                <h3>Popular Robots</h3>
                <div id="popular-robots-list">Loading...</div>
              </div>
              <div class="analytics-card" style="grid-column: 1 / -1;">
                <h3>Bookings Trend (Last 30 Days)</h3>
                <div id="bookings-trend-chart" style="height: 300px; padding: 20px;">
                  <canvas id="bookingsChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Activity Log Tab -->
          <div class="tab-content" id="activity-tab">
            <div class="content-header">
              <h2><i class="bx bx-history"></i> Activity Log</h2>
              <div style="display: flex; gap: 10px;">
                <select id="activity-type-filter">
                  <option value="">All Activities</option>
                  <option value="login">Login</option>
                  <option value="logout">Logout</option>
                  <option value="booking">Booking</option>
                  <option value="return">Return</option>
                </select>
                <button class="refresh-btn" onclick="loadActivityLogs()">
                  <i class="bx bx-refresh"></i> Refresh
                </button>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>User</th>
                    <th>Activity</th>
                    <th>Description</th>
                    <th>IP Address</th>
                    <th>Time</th>
                  </tr>
                </thead>
                <tbody id="activity-table-body">
                  <tr><td colspan="5" class="loading">Loading activity logs...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- 2FA Management Tab -->
          <div class="tab-content" id="2fa-management-tab">
            <div class="content-header">
              <h2><i class="bx bx-shield-quarter"></i> Two-Factor Authentication Management</h2>
              <button class="refresh-btn" onclick="load2FAUsers()">
                <i class="bx bx-refresh"></i> Refresh
              </button>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>User ID</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>2FA Status</th>
                    <th>Backup Codes</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="2fa-users-table-body">
                  <tr>
                    <td colspan="6" class="loading">Loading 2FA users...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: var(--card-bg); border-radius: 8px; border: 1px solid var(--border-color);">
              <h3 style="margin-top: 0; color: var(--text-primary);"><i class="bx bx-info-circle"></i> Information</h3>
              <p style="color: var(--text-secondary); margin: 10px 0;">
                This panel shows all users who have Two-Factor Authentication enabled. 
                As an administrator, you can disable 2FA for any user account if needed.
              </p>
              <p style="color: var(--warning); margin: 10px 0; font-weight: 600;">
                <i class="bx bx-error-circle"></i> Warning: Disabling 2FA will remove the security layer from the user's account.
              </p>
            </div>
          </div>

          <!-- Security Threats Tab -->
          <div class="tab-content" id="security-threats-tab">
            <div class="content-header">
              <h2><i class="bx bx-error-circle"></i> Security Threats from Blue Team</h2>
              <div style="display: flex; gap: 10px;">
                <select id="threat-severity-filter" onchange="loadSecurityThreats()" style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--card-bg); color: var(--text-primary);">
                  <option value="all">All Severities</option>
                  <option value="high">High</option>
                  <option value="critical">Critical</option>
                </select>
                <select id="threat-status-filter" onchange="loadSecurityThreats()" style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--card-bg); color: var(--text-primary);">
                  <option value="all">All Status</option>
                  <option value="unresolved">Unresolved</option>
                  <option value="resolved">Resolved</option>
                </select>
                <button class="refresh-btn" onclick="loadSecurityThreats()">
                  <i class="bx bx-refresh"></i> Refresh
                </button>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Severity</th>
                    <th>Description</th>
                    <th>Reported By</th>
                    <th>IP Address</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Admin Response</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="security-threats-table-body">
                  <tr>
                    <td colspan="9" class="loading">Loading security threats...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: var(--card-bg); border-radius: 8px; border: 1px solid var(--border-color);">
              <h3 style="margin-top: 0; color: var(--text-primary);"><i class="bx bx-info-circle"></i> Information</h3>
              <p style="color: var(--text-secondary); margin: 10px 0;">
                This panel shows security threats marked by Blue Team members. Only high and critical severity threats are displayed here.
                You can review each threat, provide a response, and mark them as resolved.
              </p>
              <p style="color: var(--warning); margin: 10px 0; font-weight: 600;">
                <i class="bx bx-error-circle"></i> Blue Team members will be notified when you respond to their threats.
              </p>
            </div>
          </div>

          <!-- Admin 2FA Settings Tab -->
          <div class="tab-content" id="admin-2fa-tab">
            <div class="content-header">
              <h2><i class="bx bx-shield"></i> My Two-Factor Authentication</h2>
              <button class="refresh-btn" onclick="loadAdmin2FAStatus()">
                <i class="bx bx-refresh"></i> Refresh
              </button>
            </div>
            
            <div style="max-width: 800px; margin: 0 auto;">
              <!-- 2FA Status Display -->
              <div id="admin-2fa-status-container" style="padding: 20px; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 20px;">
                <div class="loading">Loading 2FA status...</div>
              </div>

              <!-- 2FA Enable Form (hidden by default) -->
              <div id="admin-2fa-enable-form" style="display: none; padding: 20px; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 20px;">
                <h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="bx bx-qr-scan"></i> Set Up Two-Factor Authentication</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.):</p>
                <div style="text-align: center; margin-bottom: 20px;">
                  <img id="admin-2fa-qr-code" src="" alt="2FA QR Code" style="max-width: 250px; border: 2px solid var(--border-color); border-radius: 8px; padding: 15px; background: white;" />
                </div>
                <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 14px;">Enter the 6-digit code from your authenticator app to enable 2FA:</p>
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                  <input type="text" id="admin-2fa-verification-code" placeholder="000000" maxlength="6" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); font-size: 18px; letter-spacing: 4px; text-align: center; width: 150px;" />
                  <button id="admin-2fa-enable-btn" class="btn-primary" style="padding: 12px 24px; background: var(--primary-purple); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Enable 2FA</button>
                </div>
                <button id="admin-2fa-cancel-enable" style="padding: 8px 16px; background: var(--card-bg); color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;">Cancel</button>
              </div>

              <!-- 2FA Disable Form (hidden by default) -->
              <div id="admin-2fa-disable-form" style="display: none; padding: 20px; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 20px;">
                <h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="bx bx-shield-x"></i> Disable Two-Factor Authentication</h3>
                <p style="margin-bottom: 15px; color: var(--text-secondary);">Enter your password to disable 2FA:</p>
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                  <input type="password" id="admin-2fa-disable-password" placeholder="Your password" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); flex: 1;" />
                  <button id="admin-2fa-disable-btn" class="btn-danger" style="padding: 12px 24px; background: var(--error); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Disable 2FA</button>
                </div>
                <button id="admin-2fa-cancel-disable" style="padding: 8px 16px; background: var(--card-bg); color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;">Cancel</button>
              </div>

              <!-- Backup Codes Display -->
              <div id="admin-2fa-backup-codes" style="display: none; margin-top: 20px; padding: 20px; background: var(--card-bg); border-radius: 12px; border: 2px solid var(--warning);">
                <p style="color: var(--warning); font-weight: 600; margin-bottom: 10px; font-size: 16px;"><i class="bx bx-error-circle"></i> Save these backup codes!</p>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 15px;">You can use these codes if you lose access to your authenticator app. Each code can only be used once.</p>
                <div id="admin-2fa-backup-codes-list" style="font-family: 'Courier New', monospace; font-size: 16px; line-height: 2; color: var(--text-primary); padding: 15px; background: var(--bg-primary); border-radius: 8px; text-align: center;"></div>
                <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: center; flex-wrap: wrap;">
                  <button id="admin-2fa-backup-codes-download" style="padding: 10px 24px; background: var(--success); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <i class="bx bx-download"></i> Download Backup Codes
                  </button>
                  <button id="admin-2fa-backup-codes-close" style="padding: 10px 24px; background: var(--primary-purple); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">I've Saved These</button>
                </div>
              </div>
            </div>
            
            <!-- Change Password Section -->
            <div style="margin-top: 30px; padding: 20px; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border-color);">
              <h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="bx bx-lock"></i> Change Password</h3>
              <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 14px;">
                Update your admin account password. Your new password must meet the security requirements.
              </p>
              <div id="admin-password-change-form">
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; color: var(--text-primary); font-weight: 600;">Current Password:</label>
                  <input type="password" id="admin-old-password-input" placeholder="Enter current password" style="width: 100%; max-width: 400px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary);" />
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; color: var(--text-primary); font-weight: 600;">New Password:</label>
                  <input type="password" id="admin-new-password-input" placeholder="Enter new password" style="width: 100%; max-width: 400px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary);" />
                  <p style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                    Password must be at least 8 characters with uppercase, lowercase, digit, and special character.
                  </p>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; color: var(--text-primary); font-weight: 600;">Confirm New Password:</label>
                  <input type="password" id="admin-confirm-password-input" placeholder="Confirm new password" style="width: 100%; max-width: 400px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary);" />
                </div>
                <button id="admin-change-password-btn" style="padding: 12px 24px; background: var(--primary-purple); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                  <i class="bx bx-lock-open"></i> Change Password
                </button>
                <div id="admin-password-change-message" style="margin-top: 15px; display: none;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    </script>
    <script src="{{ url_for('static', filename='admin.js') }}"></script>
  </body>
</html>

